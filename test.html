<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live TV Player</title>

  <!-- =======  STYLE  ======= -->
  <style>
    /* --- layout --- */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: #1a1a1a;
      color: #f0f0f0;
    }
    #player-container {
      flex: 3;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #000;
    }
    video {
      width: 100%;
      height: 100%;
      background-color: #000;
    }
    #playlist-container {
      flex: 0.6;
      background-color: #282828;
      overflow-y: auto;
      border-left: 2px solid #444;
    }
    #playlist {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #playlist li {
      display: flex;
      align-items: center;
      padding: 7px;
      border-bottom: 1px solid #444;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #playlist li:hover {
      background-color: #3a3a3a;
      border-color: #FF3D00;
    }
    #playlist li img {
      width: 85px;
      height: 85px;
      margin-right: 10px;
      border-radius: 20px;
      padding: 2px;
      margin: 5px;
      border: 2px solid #fff;
      object-fit: cover;
    }
    #playlist li span {
      font-size: 1.1em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* --- responsive tweaks --- */
    @media (orientation: landscape) {
      #playlist li span { display: none; }
      #playlist li img  { margin-right: 0; }
    }
  </style>

  <!-- Shaka Player (latest) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.10/shaka-player.compiled.js" defer></script>
  <!-- Hls.js (latest) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.5.6/hls.min.js" defer></script>
</head>
<body class="unselectable">
  <!-- =======  PLAYER  ======= -->
  <div id="player-container">
    <video id="video" playsinline controls></video>
  </div>

  <!-- =======  PLAYLIST  ======= -->
  <aside id="playlist-container">
    <ul id="playlist"></ul>
  </aside>

  <!-- =======  SCRIPTS  ======= -->
  <script>
    /* -------------------------------------------------
       1. Utility: request fullscreen + orientation lock
    ---------------------------------------------------*/
    async function requestFullscreenAndLockOrientation(video) {
      try {
        if (video.requestFullscreen) await video.requestFullscreen();
        if (screen.orientation && screen.orientation.lock) {
          await screen.orientation.lock('landscape');
        }
      } catch (err) {
        console.warn('Orientation lock failed:', err);
      }
    }

    /* -------------------------------------------------
       2. Player: Shaka + Hls.js hybrid
    ---------------------------------------------------*/
    let player, hls;

    async function initShaka(url, drmData = null) {
      const video = document.getElementById('video');
      shaka.polyfill.installAll();

      // Clean up previous instances
      if (hls) { hls.destroy(); hls = null; }
      if (player) { await player.destroy(); }
      player = new shaka.Player(video);

      /* Inject custom headers (optional) */
      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        if (type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
            type === shaka.net.NetworkingEngine.RequestType.SEGMENT) {
          request.headers['Referer']    = 'https://your-site.com';
          request.headers['Origin']     = 'https://your-site.com';
          request.headers['User-Agent'] = 'CustomUserAgent/1.0';
        }
      });

      try {
        if (url.endsWith('.m3u8') && !drmData) {
          /* -------  Plain HLS  ------- */
          await player.unload();
          player.detach();

          if (video.canPlayType('application/vnd.apple.mpegurl')) {
            /* Safari / modern browsers with native HLS */
            video.src = url;
            await video.load();
            await requestFullscreenAndLockOrientation(video);
            await video.play();
            console.log('[Native] HLS playback');
          } else if (Hls.isSupported()) {
            /* Everywhere else: Hls.js */
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, async () => {
              await requestFullscreenAndLockOrientation(video);
              await video.play();
              console.log('[Hls.js] HLS playback');
            });
          } else {
            throw new Error('No HLS playback support');
          }
        } else {
          /* -------  DASH / ClearKey / HLS with DRM  ------- */
          player.configure({
            drm: drmData ? { clearKeys: { [drmData.keyId]: drmData.key } } : {}
          });

          await player.load(url);
          await requestFullscreenAndLockOrientation(video);
          await video.play();
          console.log('[Shaka] playback');
        }
      } catch (error) {
        console.error('Playback failed:', error);
      }
    }

    /* -------------------------------------------------
       3. M3U parsing
    ---------------------------------------------------*/
    function parseM3U(text) {
      const lines = text.split('\n');
      const playlist = [];
      let current = {};

      lines.forEach(line => {
        line = line.trim();
        if (line.startsWith('#EXTINF')) {
          const logo = (line.match(/tvg-logo="([^"]+)"/) || [])[1] || '';
          const name = line.split(',').pop() || 'Unknown Channel';
          current = { name, logo };
        } else if (line.startsWith('#KODIPROP') && line.includes('license_key=')) {
          const [, keyId, key] = line.match(/license_key=(.*?):(.*)/) || [];
          if (keyId && key) {
            current.drm   = 'clearkey';
            current.keyId = keyId;
            current.key   = key;
          }
        } else if (line && !line.startsWith('#')) {
          current.url = line;
          playlist.push({ ...current });
          current = {};
        }
      });
      return playlist;
    }

    /* -------------------------------------------------
       4. Load playlist + bind clicks
    ---------------------------------------------------*/
    async function loadPlaylist(m3uUrl) {
      try {
        const res  = await fetch(m3uUrl);
        const text = await res.text();
        const channels = parseM3U(text);

        const ul = document.getElementById('playlist');
        ul.innerHTML = '';

        channels.forEach(ch => {
          const li  = document.createElement('li');
          li.dataset.url    = ch.url;
          li.dataset.drm    = ch.drm ? 'clearkey' : 'false';
          if (ch.drm) {
            li.dataset.keyId = ch.keyId;
            li.dataset.key   = ch.key;
          }

          const img = document.createElement('img');
          img.src   = ch.logo || 'https://via.placeholder.com/100?text=No+Logo';
          img.alt   = ch.name;
          img.title = ch.name;

          const span = document.createElement('span');
          span.textContent = ch.name;

          li.appendChild(img);
          li.appendChild(span);
          ul.appendChild(li);

          li.addEventListener('click', () => {
            const url    = li.dataset.url;
            const isDrm  = li.dataset.drm === 'clearkey';
            const keyId  = li.dataset.keyId;
            const key    = li.dataset.key;
            const drmObj = isDrm ? { keyId, key } : null;
            initShaka(url, drmObj);
          });
        });
      } catch (err) {
        console.error('Failed to load playlist:', err);
      }
    }

    /* -------------------------------------------------
       5. Boot
    ---------------------------------------------------*/
    document.addEventListener('DOMContentLoaded', () => {
      loadPlaylist('https://livetv-6pc.pages.dev/playlist.m3u');
    });
  </script>

  <!-- =======  OPTIONAL “no‑copy” PROTECTION SCRIPTS  ======= -->
  <script>
    /* exactly the protection code you pasted; trimmed for brevity */
    var smessage = 'Content is protected !!';
    document.oncontextmenu = () => false;   // Disable right‑click
    document.onkeydown = e => {
      if (e.ctrlKey && ['c','u','s','a','x','v'].includes(e.key.toLowerCase())) {
        alert('You are not allowed to copy content or view source');
        return false;
      }
    };
    // Add any other handlers you need…
  </script>
</body>
</html>
